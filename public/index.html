<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
		<title>Brainstem Proof-of-Concept</title>
		<link type="text/css" href="css/jquery.loading.1.6.css" rel="stylesheet" />
		<link type="text/css" href="css/cupertino/jquery-ui-1.8.14.custom.css" rel="stylesheet" />
		<script type="text/javascript" src="js/jquery-1.5.1.min.js"></script>
		<script type="text/javascript" src="js/plugins/jquery-ui-1.8.14.custom.min.js"></script>
		<script type="text/javascript" src="js/plugins/jquery.loading.1.6.4.js"></script>
		<script type="text/javascript">
			$(function(){
				// Tabs
				$('#tabs').tabs();
				
				// button
				$('#button').click(function(){
					
					// clear last response, if any
					$('#api_response').empty();
					
					// show loading indicator
					$('#compute').loading({
						mask: true
						,effect: 'update'
					});
					
					// create api request URL and parameters
					var request_url = 'https://util.vivakiondemand.com/ec2/describe';
					var request_params = {
						env: 'dev',
						instanceId: $('#request_params').val()
					};
					
					// make ec2 api request
					// TODO: get this working cross-browser. Currently only works in Chrome.
					$.ajax({
						type: 'get',
						url: request_url,
						data: request_params,
						xhrFields: { withCredentials: true },
						success: function(data) {

							// display api response
							$('#api_response').append(JSON.stringify(data));
							
							// hide loading indicator
							$('#compute').loading(false);
						},
						error: function(jqXHR, message, errorThrown) {
							
							// if we're not logged in, redirect to '/login' route so that
							// API can authenticate user (via HTTPS Basic Auth).
							// browser remembers this authentication until quit.
							// this method is used for a few reasons:
							// 1) Simpler: The GUI does not have to implement authentication
							// 2) Safer: username/password is passed directly to API, bypassing GUI
							// 3) Also it doesn't seem that cross-domain HTTPS requests can be made with Basic Auth,
							//    so GUI can't do it anyway.
							// TODO: get this working cross-browser. Currently only works in Chrome.
							if (jqXHR.status == 401) {
								document.location = 'https://util.vivakiondemand.com/ec2/login';
							} else {
								
								// Display info about error
								alert("Error.\nDesc: " + message + "\nErr: " + errorThrown);

								// hide loading indicator
								$('#compute').loading(false);
							}
						}
					});
					return false;
				});
			});
				
		</script>
		<style type="text/css">
			/* jQuery demo page css*/
			body{ font: 62.5% "Trebuchet MS", sans-serif; margin: 50px;}
			.demoHeaders { margin-top: 2em; }
			#button {padding: .4em 1em .4em 1em;text-decoration: none;position: relative;}
		</style>	
	</head>
	<body>
		<h1>Brainstem GUI Proof-of-Concept</h1>
		<div id="tabs">
			<ul>
				<li><a href="#compute">Compute</a></li>
				<li><a href="#storage">Storage</a></li>
				<li><a href="#database">Database</a></li>
			</ul>
			<div id="compute">
				<label for="request_params">Comma-separated list of instance IDs (in dev)</label>
				<input type="text" name="request_params" value="i-b285d4df" id="request_params" style="width: 500px;">
				
				<!-- Dialog NOTE: Dialog is not generated by UI in this demo so it can be visually styled in themeroller-->
				<p><a href="#" id="button" class="ui-state-default ui-corner-all"></span>Test Brainstem API Request</a></p>
				<div id="api_response">
				</div>
			</div>
			<div id="storage">
				Phasellus mattis tincidunt nibh. Cras orci urna, blandit id, pretium vel, aliquet ornare, felis. Maecenas scelerisque sem non nisl. Fusce sed lorem in enim dictum bibendum.
			</div>
			<div id="database">
				Nam dui erat, auctor a, dignissim quis, sollicitudin eu, felis. Pellentesque nisi urna, interdum eget, sagittis et, consequat vestibulum, lacus. Mauris porttitor ullamcorper augue.
			</div>
		</div>
	</body>
</html>